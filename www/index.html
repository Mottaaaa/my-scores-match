<!DOCTYPE html>
<html lang="pt">

<head>
	<meta charset="utf-8" />
	<title>My Score - Match</title>
	<link href="./styles/estilos.css" rel="stylesheet" type="text/css" />
	<script src="./scripts/jquery.min.js"></script>
	<script src="./scripts/modernizr.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<script>
	let matchID = '';
	function onMessage(evt) {
		if (evt.origin == "http://localhost:8081") {
			let match = JSON.parse(evt.data);
			matchID = match.matchID;
			document.getElementById("match").innerText = match.matchName;
			if (match.score !== undefined) {
				document.getElementById('homeGoals').value = match.score[0];
				document.getElementById('visitorGoals').value = match.score[1];
			} else {
				document.getElementById('homeGoals').value = '';
				document.getElementById('visitorGoals').value = '';
			}
		} else {
			alert("Janela filha rejeita mensagem de " + evt.origin);
		}

	}

	function saveScore() {
		let homeGoals = document.getElementById('homeGoals').value;
		let visitorGoals = document.getElementById('visitorGoals').value;
		if (homeGoals >= 0 && visitorGoals >= 0) {
			let matchName = document.getElementById('match').innerText;
			let score = [homeGoals, visitorGoals];
			let result = {
				matchID,
				matchName,
				score
			};

			console.log(result);
			window.opener.postMessage(JSON.stringify(result), "*");
		}
	}

	function setup() {
		document.getElementById('buttonSaveScore').addEventListener('click', saveScore, true);
	}

	window.addEventListener("message", onMessage, true);
	window.onload = setup;
</script>

<body>
	<div class='container'>
		<div class='row d-flex justify-content-center'>
			<div>
				<h1>Match</h1>
			</div>
			<div>
				<h2 id="match"></h2>
			</div>
		</div>
		<div class='row d-flex justify-content-center'>
			<form id="scoreForm">
				<div class="form-group">
					<label for="home" name="home">Home:</label>
					<input type="number" id="homeGoals" min="0" placeholder="Enter Home Goals" />
					<label for="visitor" name="visitor">Visitor:</label>
					<input type="number" id="visitorGoals" min="0" placeholder="Enter Visitor Goals" />
					<input type="button" class='btn btn-primary' id="buttonSaveScore" value='Register' />
				</div>
			</form>
		</div>
	</div>
</body>
</html>